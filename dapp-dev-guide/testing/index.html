<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Testing Contracts | Casper</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://operators.casper.network//docs/dapp-dev-guide/testing"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Testing Contracts | Casper"><meta data-react-helmet="true" name="description" content="As part of the Casper local Rust contract development environment, we provide an in-memory virtual machine and a testing framework against which you can run your contract. You do not need to set up a full node for testing. We provide a testing framework that simulates deploy execution, enables monitoring global state changes using assertions, and confirms a successful deploy of the smart contract."><meta data-react-helmet="true" property="og:description" content="As part of the Casper local Rust contract development environment, we provide an in-memory virtual machine and a testing framework against which you can run your contract. You do not need to set up a full node for testing. We provide a testing framework that simulates deploy execution, enables monitoring global state changes using assertions, and confirms a successful deploy of the smart contract."><link data-react-helmet="true" rel="shortcut icon" href="/docs/image/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://operators.casper.network//docs/dapp-dev-guide/testing"><link data-react-helmet="true" rel="alternate" href="https://operators.casper.network//docs/dapp-dev-guide/testing" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://operators.casper.network//docs/dapp-dev-guide/testing" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.cb2bace2.css">
<link rel="preload" href="/docs/assets/js/runtime~main.5567e44f.js" as="script">
<link rel="preload" href="/docs/assets/js/main.eb1c9356.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><img src="/docs/icon/logo-dark.svg" alt="Casper Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs/icon/logo-white.svg" alt="Casper Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link" href="/docs/workflow">How To&#x27;s</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/dapp-dev-guide">Developers</a><a class="navbar__item navbar__link" href="/docs/operators">Operators</a><a class="navbar__item navbar__link" href="/docs/design">Design</a><a class="navbar__item navbar__link" href="/docs/economics">Economics</a><a class="navbar__item navbar__link" href="/docs/staking">Staking</a><a class="navbar__item navbar__link" href="/docs/glossary">Glossary</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/dapp-dev-guide/testing" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><a href="https://github.com/casper-network/docs-app" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒ™</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/dapp-dev-guide">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/dapp-dev-guide/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Writing Smart Contracts</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/dapp-dev-guide/testing">Testing Contracts</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/dapp-dev-guide/setup-nctl">Local Network Testing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/dapp-dev-guide/upgrading-contracts">Upgrading Contracts</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/dapp-dev-guide/deploying-contracts">Deploying Contracts</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/dapp-dev-guide/calling-contracts">Calling Contracts</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/dapp-dev-guide/execution-error-codes">Execution Error Codes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/dapp-dev-guide/keys">Working with Cryptographic Keys</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">SDK Client Libraries</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Testing Contracts</h1></header><p>As part of the Casper local Rust contract development environment, we provide an in-memory virtual machine and a <a href="https://docs.rs/casper-engine-test-support/latest/casper_engine_test_support" target="_blank" rel="noopener noreferrer">testing framework</a> against which you can run your contract. You do not need to set up a full node for testing. We provide a testing framework that simulates deploy execution, enables monitoring global state changes using assertions, and confirms a successful deploy of the smart contract.</p><p>Here is the main testing flow:</p><ol><li>Initialize the system and create a deploy</li><li>Execute the deploy, which will call the smart contract</li><li>Query the context for changes and verify that the result matches the expected values</li></ol><p>It is also possible to build scripts with this environment and set up continuous integration for contract code. This environment enables the testing of blockchain-enabled systems from end to end.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="initialize-the-system-and-create-a-deploy"></a>Initialize the System and Create a Deploy<a class="hash-link" href="#initialize-the-system-and-create-a-deploy" title="Direct link to heading">#</a></h2><p>The following steps guide you through the initialization of the system and deploy creation.</p><ol><li><a href="/docs/dapp-dev-guide/testing#define-global-variables-and-constants">Define global variables and constants</a></li><li><a href="/docs/dapp-dev-guide/testing#import-builders-and-constants">Import builders and constants</a></li><li><a href="/docs/dapp-dev-guide/testing#create-a-deploy-item">Create a deploy item</a></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="define-global-variables-and-constants"></a>Define Global Variables and Constants<a class="hash-link" href="#define-global-variables-and-constants" title="Direct link to heading">#</a></h3><p>You can use global variables and constants in later steps to derive values and create components.</p><p><strong>Global Variables and Constants</strong></p><p>The framework uses global variables and constants to find the compiled WASM file and to create the deploy.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use std::path::PathBuf;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const MY_ACCOUNT: [u8; 32] = [7u8; 32];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const KEY: &amp;str = &quot;my-key-name&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const VALUE: &amp;str = &quot;hello world&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const RUNTIME_ARG_NAME: &amp;str = &quot;message&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const CONTRACT_WASM: &amp;str = &quot;contract.wasm&quot;;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><em><code>KEY</code></em> and <em><code>VALUE</code></em> : These constants are the global states we are using to test whether the deploy has been executed correctly. KEY acts as the input to the assertion and VALUE acts as the output from the assertion</li><li><em><code>PathBuff</code></em> : The contract uses this variable to find the compiled WASM file</li><li><em><code>RUNTIME_ARG_NAME</code></em> and <em><code>CONTRACT_WASM</code></em> : Variables used to build the deploy</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="import-builders-and-constants"></a>Import Builders and Constants<a class="hash-link" href="#import-builders-and-constants" title="Direct link to heading">#</a></h3><p>We derive imports from the dependencies in the Cargo.toml file. If you see problems while importing, fix the dependency settings in the Cargo.toml file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use casper_engine_test_support::{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    DeployItemBuilder, ExecuteRequestBuilder, InMemoryWasmTestBuilder,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ARG_AMOUNT, DEFAULT_ACCOUNT_ADDR, DEFAULT_ACCOUNT_INITIAL_BALANCE, DEFAULT_GENESIS_CONFIG, DEFAULT_PAYMENT,  DEFAULT_RUN_GENESIS_REQUEST,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">use casper_types::{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    account::AccountHash, runtime_args, Key, PublicKey, RuntimeArgs, SecretKey, U512,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="create-a-deploy-item"></a>Create a Deploy Item<a class="hash-link" href="#create-a-deploy-item" title="Direct link to heading">#</a></h3><p>The testing framework uses the <code>DeployItem</code> to derive the <code>ExecuteRequest</code> to send to the test contract.</p><p><strong>Declaring Local Variables</strong></p><p>These are the variables used to construct the <em>deploy_item</em>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let secret_key = SecretKey::ed25519_from_bytes(MY_ACCOUNT).unwrap();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let public_key = PublicKey::from(&amp;secret_key);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let account_addr = AccountHash::from(&amp;public_key);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let session_code = PathBuf::from(CONTRACT_WASM);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let session_args = runtime_args! {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            RUNTIME_ARG_NAME =&gt; VALUE,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong><em>Variable details</em></strong></p><ul><li><em><code>secret_key</code></em> and <em><code>public_key</code></em> : Derives the account address</li><li><em><code>account address</code></em> : Gets authorization key and location</li><li><em><code>session_code</code></em> : Gets the path to your actual contract WASM file on your system</li><li><em><code>session_args</code></em> : Gets the values of runtime arguments</li></ul><p><strong>Create Deploy Item</strong></p><p>Before deploying the contract in the framework, you need to have a <code>Deploy Item</code> to send to the request. <code>DeployItemBuilder</code> will directly instantiate the deploy item using associate builder methods.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let deploy_item = DeployItemBuilder::new()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .with_empty_payment_bytes(runtime_args! {ARG_AMOUNT =&gt; *DEFAULT_PAYMENT})</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .with_session_code(session_code, session_args)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .with_authorization_keys(&amp;[account_addr])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .with_address(account_addr)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong><em>Constructor methods</em></strong></p><p>The deploy item contains the following elements:</p><ul><li><p><em><code>payment details</code></em> : This can be standard payments or custom payments. Standard payment is the bare payment amount a user wishes to pay for the deploy. Custom payment comes with payment codes or functions that indicate payments by module bytes</p><p><strong><em>empty_payment_bytes</em></strong> implies the module bytes inside the deploy item&#x27;s payment part are empty. It directs the framework to use the standard payment contract that is the original amount (DEFAULT_PAYMENT)</p></li></ul><p align="center"><img src="/docs/image/EmptyModuleBytes.png" width="300"></p><ul><li><p><em><code>session_code</code></em> : Sets the session code for the deploy using session_code and session_args</p><ul><li><em>PathBuff</em> : Helps to find the compiled WASM file in your WASM directory. This is a mutable path with some extended functionalities</li></ul></li><li><p><em><code>authorization_keys</code></em> : Sets authorization keys to authorize the deploy. To check the list of keys that authorize the call. See: <a href="/docs/design/accounts#accounts-permissions">Permissions model</a>.</p></li><li><p><em><code>address</code></em> : Sets the address of the deploy</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="deploy-the-smart-contract"></a>Deploy the Smart Contract<a class="hash-link" href="#deploy-the-smart-contract" title="Direct link to heading">#</a></h2><p>Follow these steps to deploy the smart contract:</p><ol><li><a href="/docs/dapp-dev-guide/testing#create-the-builder">Create the builder</a></li><li><a href="/docs/dapp-dev-guide/testing#create-an-execute-request">Create the execute request</a></li><li><a href="/docs/dapp-dev-guide/testing#deploy-the-contract">Deploy the contract</a></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="create-the-builder"></a>Create the Builder<a class="hash-link" href="#create-the-builder" title="Direct link to heading">#</a></h3><p><code>InMemoryWasmTestBuilder</code> is the builder for a simple WASM test that uses the state held entirely in memory. It provides methods to simulate deploys to the blockchain array and make queries to whatever state you find in the global state.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let mut builder = InMemoryWasmTestBuilder::default();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.run_genesis(&amp;DEFAULT_RUN_GENESIS_REQUEST).commit();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>Genesis</code> : <em>run_genesis</em> call will initialize the blockchain network to get your first block. When you initialize a blockchain network, there needs to be a genesis block as a starting point to the incoming blocks. The subsequent set of deploys will execute after the execution of the genesis block.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="create-an-execute-request"></a>Create an Execute Request<a class="hash-link" href="#create-an-execute-request" title="Direct link to heading">#</a></h3><p>After creating the <code>deploy_item</code>, wrap it in an <code>ExecuteRequest</code> created by the <code>ExecuteRequestBuilder</code>; then, the builder instance will construct the deploy item and return the execute_request.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let execute_request = ExecuteRequestBuilder::from_deploy_item(deploy_item).build();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="deploy-the-contract"></a>Deploy the Contract<a class="hash-link" href="#deploy-the-contract" title="Direct link to heading">#</a></h3><p>InMemoryWasmTestBuilder instance will execute the <em>execute_request</em>, which carries the deploy details.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">builder.exec(execute_request).commit().expect_success();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong><em>Builder methods</em></strong></p><ul><li><em><code>Commit()</code></em> - This will process the execution result of the previous <em>execute_request</em> on the latest post-state hash, which is the hash function&#x27;s output</li><li><em><code>expect_success()</code></em> - This will assert the deploy as a successful execution. If it is not successful, it will crash the test</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="query-and-assert"></a>Query and Assert<a class="hash-link" href="#query-and-assert" title="Direct link to heading">#</a></h2><p>This is the final step of the test contract execution. In this step, you will create a query result to send to post-assertion, and execute the deploy using the previously created components and finally perform the post-assertion to confirm the expected change on the test contract.</p><p>Query and assertion steps are as below:</p><ol><li><a href="/docs/dapp-dev-guide/testing#pre-assert-the-status">Pre-assert the state</a></li><li><a href="/docs/dapp-dev-guide/testing#deploy-the-contract-1">Deploy the contract</a></li><li><a href="/docs/dapp-dev-guide/testing#post-assertion-to-confirm-deploy">Post-assertion to confirm deploy</a></li></ol><p>The smart contract creates a new value <em>hello world</em> under the KEY, <em>my-key-name</em>. You can extract this value from the global state of the blockchain using the <code>query_result</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="pre-assert-the-status"></a>Pre-Assert the Status<a class="hash-link" href="#pre-assert-the-status" title="Direct link to heading">#</a></h3><p>Pre-assertions are helpful to confirm the existing state has not changed before the test execution. To accomplish this, create a query result using the builder and assert that the result of the query should not be equal to the value of KEY.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  let result_of_query = builder.query(None, Key::Account(account_addr), &amp;[KEY.to_string()]);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  assert!(result_of_query.is_err());</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Method <code>query()</code> is to query the state for a stored value, KEY in this sample.</p><p><strong>Parameters</strong></p><ul><li><em><code>maybe_post_state</code></em> : Not defined in this case</li><li><em><code>base_key</code></em> : Contact where you find the named-key - here default address</li><li><em><code>path</code></em> : Global KEY constant</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="deploy-the-contract-1"></a>Deploy the Contract<a class="hash-link" href="#deploy-the-contract-1" title="Direct link to heading">#</a></h3><p>Deploy is done by executing the previously created <code>execute_request</code> instance.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">builder.exec(execute_request).commit().expect_success();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="post-assertion-to-confirm-deploy"></a>Post-Assertion to Confirm Deploy<a class="hash-link" href="#post-assertion-to-confirm-deploy" title="Direct link to heading">#</a></h3><p>This will query the post-deploy value and assert for its change.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  let result_of_query = builder</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .query(None, Key::Account(account_addr), &amp;[KEY.to_string()])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .expect(&quot;should be stored value.&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .as_cl_value()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .expect(&quot;should be cl value.&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .clone()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .into_t::&lt;String&gt;()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .expect(&quot;should be string.&quot;);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong><em>Builder methods</em></strong></p><ul><li><p><em><code>query()</code></em> : Queries the state for a given value</p></li><li><p><em><code>expect()</code></em> : Validates the query which contains the output message. This will unwrap the value; the test will panic and crash if the value can&#x27;t be unwrapped. The string value inside the argument will output as the reason to crash</p></li><li><p><em><code>as_cl_value()</code></em> : Returns a wrapped <a href="/docs/design/serialization-standard#serialization-standard-values">CLValue</a> if this is a CLValue variant</p></li><li><p><em><code>clone()</code></em> : Breaks the reference to the CLValue so that it will provide brand new CLValue</p></li><li><p><em><code>Into_t()</code></em> : Converts the CLValue back to the original type (i.e., a String type in this sample). Note that the <code>expected_value</code> is a <code>String</code> type lifted to the <code>Value</code> type. It is also possible to map <code>returned_value</code> to the <code>String</code> type</p></li></ul><p><strong>Assertion</strong></p><p>Assert that the query&#x27;s result matches the expected value; here, the expected value is &quot;hello world&quot;.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">assert_eq!(result_of_query, VALUE);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="final-test-sample"></a>Final Test Sample<a class="hash-link" href="#final-test-sample" title="Direct link to heading">#</a></h2><p>The code below is the simple test generated by <a href="https://crates.io/crates/cargo-casper" target="_blank" rel="noopener noreferrer">cargo-casper</a> (found in <code>tests/src/integration_tests.rs</code> of a project created by the tool).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">mod tests {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   use casper_engine_test_support::{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        DeployItemBuilder, ExecuteRequestBuilder, InMemoryWasmTestBuilder, ARG_AMOUNT,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        DEFAULT_ACCOUNT_ADDR, DEFAULT_ACCOUNT_INITIAL_BALANCE, DEFAULT_GENESIS_CONFIG,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        DEFAULT_PAYMENT, DEFAULT_RUN_GENESIS_REQUEST,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    use casper_types::{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        account::AccountHash, runtime_args, Key, PublicKey, RuntimeArgs, SecretKey, U512,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    use std::path::PathBuf;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const MY_ACCOUNT: [u8; 32] = [7u8; 32];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Define `KEY` constant to match that in the contract.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const KEY: &amp;str = &quot;my-key-name&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const VALUE: &amp;str = &quot;hello world&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const RUNTIME_ARG_NAME: &amp;str = &quot;message&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const CONTRACT_WASM: &amp;str = &quot;contract.wasm&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">#[test]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn should_store_hello_world() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let secret_key = SecretKey::ed25519_from_bytes(MY_ACCOUNT).unwrap();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let public_key = PublicKey::from(&amp;secret_key);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let account_addr = AccountHash::from(&amp;public_key);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let session_code = PathBuf::from(CONTRACT_WASM);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let session_args = runtime_args! {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            RUNTIME_ARG_NAME =&gt; VALUE,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let deploy_item = DeployItemBuilder::new()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // .with_payment_bytes(module_bytes, args)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .with_empty_payment_bytes(runtime_args! {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ARG_AMOUNT =&gt; *DEFAULT_PAYMENT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            })</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .with_session_code(session_code, session_args)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .with_authorization_keys(&amp;[account_addr])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .with_address(account_addr)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let execute_request = ExecuteRequestBuilder::from_deploy_item(deploy_item).build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let mut builder = InMemoryWasmTestBuilder::default();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.run_genesis(&amp;DEFAULT_RUN_GENESIS_REQUEST).commit();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// prepare assertions.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let result_of_query = builder.query(None, Key::Account(account_addr), &amp;[KEY.to_string()]);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        assert!(result_of_query.is_err());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// deploy the contract.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.exec(execute_request).commit().expect_success();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// make assertions</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        let result_of_query = builder</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .query(None, Key::Account(account_addr), &amp;[KEY.to_string()])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .expect(&quot;should be stored value.&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .as_cl_value()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .expect(&quot;should be cl value.&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .clone()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .into_t::&lt;String&gt;()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .expect(&quot;should be string.&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">assert_eq!(result_of_query, VALUE);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    panic!(&quot;Execute &quot;cargo test&quot; to test the contract, not &quot;cargo run&quot;.&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can see the result of the above test in this screen capture:</p><p align="center"><img src="/docs/image/test-compile-result.png" width="700"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/casper-network/documentation/tree/master/docs/casper/dapp-dev-guide/testing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/dapp-dev-guide/writing-contracts/assembly-script"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« AssemblyScript</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/dapp-dev-guide/setup-nctl"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Local Network Testing Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#initialize-the-system-and-create-a-deploy" class="table-of-contents__link">Initialize the System and Create a Deploy</a><ul><li><a href="#define-global-variables-and-constants" class="table-of-contents__link">Define Global Variables and Constants</a></li><li><a href="#import-builders-and-constants" class="table-of-contents__link">Import Builders and Constants</a></li><li><a href="#create-a-deploy-item" class="table-of-contents__link">Create a Deploy Item</a></li></ul></li><li><a href="#deploy-the-smart-contract" class="table-of-contents__link">Deploy the Smart Contract</a><ul><li><a href="#create-the-builder" class="table-of-contents__link">Create the Builder</a></li><li><a href="#create-an-execute-request" class="table-of-contents__link">Create an Execute Request</a></li><li><a href="#deploy-the-contract" class="table-of-contents__link">Deploy the Contract</a></li></ul></li><li><a href="#query-and-assert" class="table-of-contents__link">Query and Assert</a><ul><li><a href="#pre-assert-the-status" class="table-of-contents__link">Pre-Assert the Status</a></li><li><a href="#deploy-the-contract-1" class="table-of-contents__link">Deploy the Contract</a></li><li><a href="#post-assertion-to-confirm-deploy" class="table-of-contents__link">Post-Assertion to Confirm Deploy</a></li></ul></li><li><a href="#final-test-sample" class="table-of-contents__link">Final Test Sample</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright"><div class="footer-inner-container">
    <div class="footer-top">
        <ul class="items">
            <li><a href="https://arxiv.org/pdf/2101.02159.pdf" target="_blank" rel="noopener">White Paper</a></li>
            <li>
                <a href="https://casper.network/docs" target="_blank" rel="noopener"> Docs </a>
            </li>
            <li><a href="https://devxdao.com/" target="_blank" rel="noopener">Grant Program</a></li>
            <li><a href="https://casper.network/network/casper-association" target="_blank" rel="noopener">Casper Association</a></li>
        </ul>
    </div>
    <div class="footer-bottom">
        <ul class="items left">
            <li>
                <a href="https://casper.network/en/network" target="_blank" rel="noopener">
                    <img class="footer-logo" src="/docs/icon/logo-white.svg" alt="Casper Logo">
                </a>
            </li>
            <li>Â© 2021 Casper Association</li>
        </ul>
        <ul class="items right">
            <li class="trademark">
                <a href="https://casper.network/network/trademark-policy" target="_blank" rel="noopener">Trademark Policy and Guidelines</a>
            </li>
        </ul>
    </div>
</div>
</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.5567e44f.js"></script>
<script src="/docs/assets/js/main.eb1c9356.js"></script>
</body>
</html>